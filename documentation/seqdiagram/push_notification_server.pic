.PS
copy "sequence.pic"

boxwid = 1.1
movewid = 1

# Object definition
object(H,"handset")
object(S,"notif_server")
object(W,"web_app")
step

# Bootstrap
active(H)
step
message(H,H,"Unique ID generation (TOKEN)")

# Registration on Notification Server
message(H,S,"register(token)")
active(S)
message(S,S,"check(token); check(ip) / delete")
message(S,S,"store(token,ip)")
message(S,H,"REGISTERED(publicURL)")
inactive(S)

step

# User opens a web app with PUSH notif
message(H,W,"GET /")
active(W)
message(W,H,"200 OK / HTML, CSS, JS App ...")
message(H,W,"AJAX: register(publicURL, publicKey)")
message(W,H,"200 OK")
inactive(W)
inactive(H)
step

# Push notification
active(W)
message(W,W,"Generate Data notification")
message(W,W,"crypto(data,publicKey)")
message(W,S,"POST publicURL?origin&data")
active(S)
message(S,W,"Verify origin")
inactive(W)
message(S,S,"check(token) / recover ip")
message(S,H,"notify(origin,data)")
inactive(S)
active(H)
message(H,H,"do something")
message(H,W,"OPTIONAL (ACK)")
inactive(H)

# End diagram
step
complete(H)
complete(S)
complete(W)

.PE