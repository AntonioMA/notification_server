.PS
copy "sequence.pic"

#boxwid = 1
movewid = 1.2

# Object definition
object(A,"application")
object(N,"node/core")
object(S,"notification")
object(W,"web_app")
step

# Get web page / app
active(A)
message(A,W,"GET /")
active(W)
return_message(W,A,"200 OK")
inactive(W)
step

# Register application
message(A,N,"requestRemotePermission()")
active(N)
message(N,S,"GET /register/app?t=APP_UUID&n=NODE_UUID")
active(S)
message(S,S,"check_app(APP_UUID); delete")
message(S,S,"store(APP,UUID,NODE_UUID)")
return_message(S,N,"REGISTERED&url=URL")
inactive(S)
return_message(N,A,"OK: publicURL")
inactive(N)
message(A,W,"AJAX: register(publicURL, publicKey)")
active(W)
return_message(W,A,"200 OK")
inactive(W)
step
inactive(A)

# End diagram
step
complete(A)
complete(N)
complete(S)
complete(W)

.PE